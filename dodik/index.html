<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Wedding of Ladynah & Dodik</title>
    
    <!-- Open Graph Meta Tags untuk WhatsApp Preview -->
    <meta property="og:title" content="The Wedding of Ladynah & Dodik" />
    <meta property="og:description" content="Selasa, 17 Juni 2025 - Akad Nikah | Kamis, 19 Juni 2025 - Resepsi. Dengan penuh kebahagiaan, kami mengundang Anda untuk hadir dalam acara pernikahan kami." />
    <meta property="og:image" content="https://www.gasnikah.com/wp-content/uploads/2025/05/THUMBNAIL-99.jpg" />
    <meta property="og:image:secure_url" content="https://www.gasnikah.com/wp-content/uploads/2025/05/THUMBNAIL-99.jpg" />
    <meta property="og:image:type" content="image/jpeg" />
    <meta property="og:image:width" content="768" />
    <meta property="og:image:height" content="1156" />
    <meta property="og:image:alt" content="Undangan Pernikahan Ladynah & Dodik" />
    <meta property="og:url" content="" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="The Wedding of Ladynah & Dodik" />
    <meta property="og:locale" content="id_ID" />
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="The Wedding of Ladynah & Dodik" />
    <meta name="twitter:description" content="Selasa, 17 Juni 2025 - Akad Nikah | Kamis, 19 Juni 2025 - Resepsi. Dengan penuh kebahagiaan, kami mengundang Anda untuk hadir dalam acara pernikahan kami." />
    <meta name="twitter:image" content="https://www.gasnikah.com/wp-content/uploads/2025/05/THUMBNAIL-99.jpg" />
    <meta name="twitter:image:alt" content="Undangan Pernikahan Ladynah & Dodik" />
    
    <!-- WhatsApp specific meta tags -->
    <meta property="whatsapp:title" content="The Wedding of Ladynah & Dodik" />
    <meta property="whatsapp:image" content="https://www.gasnikah.com/wp-content/uploads/2025/05/THUMBNAIL-99.jpg" />
    
    <!-- Fallback untuk Android WhatsApp -->
    <meta name="description" content="Selasa, 17 Juni 2025 - Akad Nikah | Kamis, 19 Juni 2025 - Resepsi. Dengan penuh kebahagiaan, kami mengundang Anda untuk hadir dalam acara pernikahan kami." />
    <meta name="image" content="https://www.nikah.com/wp-content/uploads/2025/05/THUMBNAIL-99.jpg" />
    
    <!-- Preload gambar untuk performa lebih baik -->
    <link rel="preload" as="image" href="https://www.nikah.com/wp-content/uploads/2025/05/THUMBNAIL-99.jpg" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
            overflow: hidden;
        }
        
        iframe {
            width: 100%;
            height: 100vh;
            border: none;
            display: block;
        }
    </style>
</head>
<body>
    <!-- Main iframe -->
    <iframe id="undanganFrame" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox"></iframe>
    
    <script>
        // Ambil parameter ?to= dari URL repal.com
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }
        
        // Update meta tags berdasarkan nama tamu
        function updateMetaTags(guestName) {
            if (guestName) {
                // Update title
                document.title = `The Wedding of Ladynah & Dodik - Undangan untuk ${guestName}`;
                
                // Update Open Graph title
                const ogTitle = document.querySelector('meta[property="og:title"]');
                if (ogTitle) {
                    ogTitle.content = `The Wedding of Ladynah & Dodik - Undangan untuk ${guestName}`;
                }
                
                // Update description dengan nama tamu dan detail acara
                const ogDescription = document.querySelector('meta[property="og:description"]');
                if (ogDescription) {
                    ogDescription.content = `${guestName}, dengan penuh kebahagiaan kami mengundang Anda: Akad Nikah (Selasa, 17 Juni 2025) & Resepsi (Kamis, 19 Juni 2025) `;
                }
                
                // Update URL
                const ogUrl = document.querySelector('meta[property="og:url"]');
                if (ogUrl) {
                    ogUrl.content = window.location.href;
                }
                
                // Update Twitter meta
                const twitterTitle = document.querySelector('meta[name="twitter:title"]');
                if (twitterTitle) {
                    twitterTitle.content = `The Wedding of Ladynah & Dodik - Undangan untuk ${guestName}`;
                }
                
                const twitterDescription = document.querySelector('meta[name="twitter:description"]');
                if (twitterDescription) {
                    twitterDescription.content = `${guestName}, dengan penuh kebahagiaan kami mengundang Anda: Akad Nikah (Selasa, 17 Juni 2025) & Resepsi (Kamis, 19 Juni 2025) `;
                }
                
                // Update WhatsApp meta
                const whatsappTitle = document.querySelector('meta[property="whatsapp:title"]');
                if (whatsappTitle) {
                    whatsappTitle.content = `The Wedding of Ladynah & Dodik - Undangan untuk ${guestName}`;
                }
            } else {
                // Set URL untuk meta tags
                const ogUrl = document.querySelector('meta[property="og:url"]');
                if (ogUrl) {
                    ogUrl.content = window.location.href;
                }
            }
        }
        
        // Function untuk mengecek apakah URL adalah external link
        function isExternalLink(url) {
            try {
                const urlObj = new URL(url);
                const currentDomain = window.location.hostname;
                const linkDomain = urlObj.hostname;
                
                // Daftar domain yang dianggap external dan harus dibuka di tab baru
                const externalDomains = [
                    'maps.google.com',
                    'www.google.com',
                    'goo.gl',
                    'maps.app.goo.gl',
                    'wa.me',
                    'api.whatsapp.com',
                    'instagram.com',
                    'www.instagram.com',
                    'facebook.com',
                    'www.facebook.com',
                    'twitter.com',
                    'www.twitter.com',
                    'x.com',
                    'www.x.com',
                    'youtube.com',
                    'www.youtube.com',
                    'youtu.be',
                    'tiktok.com',
                    'www.tiktok.com'
                ];
                
                // Cek jika domain berbeda dari domain saat ini atau ada dalam daftar external
                return linkDomain !== currentDomain || externalDomains.includes(linkDomain);
            } catch (e) {
                return false;
            }
        }
        
        // Handler untuk menangkap klik pada iframe
        function handleIframeClick(event) {
            const iframe = document.getElementById('undanganFrame');
            
            try {
                // Coba akses iframe content
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                // Event listener untuk semua link dalam iframe
                const links = iframeDoc.querySelectorAll('a[href]');
                
                links.forEach(link => {
                    link.addEventListener('click', function(e) {
                        const href = this.getAttribute('href');
                        
                        if (href && isExternalLink(href)) {
                            e.preventDefault();
                            window.open(href, '_blank');
                        }
                    });
                });
                
            } catch (error) {
                console.log('Cannot access iframe content due to CORS policy');
                // Jika tidak bisa akses iframe karena CORS, gunakan message listener
            }
        }
        
        // Message listener untuk komunikasi dengan iframe
        window.addEventListener('message', function(event) {
            // Verifikasi origin untuk keamanan
            if (event.origin !== 'https://ladynahdodik.my.id') {
                return;
            }
            
            if (event.data && event.data.type === 'external_link') {
                const url = event.data.url;
                if (url && isExternalLink(url)) {
                    window.open(url, '_blank');
                }
            }
        });
        
        // Ambil nama tamu dari parameter
        const guestName = getUrlParameter('to');
        const iframe = document.getElementById('undanganFrame');
        
        // Update meta tags
        updateMetaTags(guestName);
        
        // URL nikah.com
        let gasnikahUrl = 'https://ladynahdodik.my.id/dodik/preview.html';
        
        // Kalau ada parameter ?to=, tambahin ke URL gasnikah
        if (guestName) {
            gasnikahUrl += '?to=' + encodeURIComponent(guestName);
        }
        
        // Set iframe ke gasnikah.com dengan parameter
        iframe.src = gasnikahUrl;
        
        // Event listener ketika iframe selesai load
        iframe.addEventListener('load', function() {
            handleIframeClick();
            
            // Inject script ke iframe untuk handle external links (jika memungkinkan)
            try {
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                const script = iframeDoc.createElement('script');
                script.textContent = `
                    // Override untuk semua link external
                    document.addEventListener('click', function(e) {
                        const link = e.target.closest('a[href]');
                        if (link) {
                            const href = link.getAttribute('href');
                            if (href && (
                                href.includes('maps.google.com') ||
                                href.includes('goo.gl') ||
                                href.includes('wa.me') ||
                                href.includes('instagram.com') ||
                                href.includes('facebook.com') ||
                                href.includes('twitter.com') ||
                                href.includes('x.com') ||
                                href.includes('youtube.com') ||
                                href.includes('youtu.be') ||
                                href.includes('tiktok.com') ||
                                href.startsWith('http') && !href.includes(window.location.hostname)
                            )) {
                                e.preventDefault();
                                // Kirim pesan ke parent window
                                window.parent.postMessage({
                                    type: 'external_link',
                                    url: href
                                }, '*');
                            }
                        }
                    });
                `;
                iframeDoc.head.appendChild(script);
            } catch (error) {
                console.log('Cannot inject script to iframe due to CORS policy');
            }
        });
        
        // Fungsi untuk generate WhatsApp share link
        function generateWhatsAppLink() {
            const currentUrl = window.location.href;
            const message = guestName 
                ? `The Wedding of Ladynah & Dodik - Undangan untuk ${guestName}\n\nAkad Nikah: Selasa, 17 Juni 2025\n$\nResepsi: Kamis, 19 Juni 2025\n\n${currentUrl}`
                : `The Wedding of Ladynah & Dodik\n\nAkad Nikah: Selasa, 17 Juni 2025\n$\nResepsi: kamis, 19 Juni 2025\n\n${currentUrl}`;
            
            return `https://wa.me/?text=${encodeURIComponent(message)}`;
        }
        
        // Event listener untuk keyboard shortcut share (Ctrl+S atau Cmd+S)
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                window.open(generateWhatsAppLink(), '_blank');
            }
        });
        
        // Fungsi untuk copy link
        function copyInvitationLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                alert('Link undangan telah disalin!');
            }).catch(() => {
                // Fallback untuk browser lama
                const textArea = document.createElement('textarea');
                textArea.value = window.location.href;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('Link undangan telah disalin!');
            });
        }
        
        // Expose functions ke global scope untuk debugging
        window.shareToWhatsApp = generateWhatsAppLink;
        window.copyLink = copyInvitationLink;
    </script>
</body>
</html>
